<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Ticket - {{ reservation.reference|default:reservation.id }}</title>
  <style>
    /* Inline professional styling for WeasyPrint */
    body { font-family: Arial, Helvetica, sans-serif; color: #222; margin: 0; padding: 20px; }
    .header { display:flex; align-items:center; gap:12px; }
    .logo { width:56px; height:56px; background:#1f5233; color:#fff; display:flex; align-items:center; justify-content:center; border-radius:8px; font-weight:700; font-size:20px; }
    .company { font-size:20px; font-weight:700; color:#1f5233; }
    .meta { margin-top:8px; font-size:12px; color:#666; }
    .section { margin-top:18px; }
    .section h3 { margin:0 0 8px 0; font-size:13px; color:#1f5233; }
    .grid { width:100%; border-collapse:collapse; }
    .grid td { padding:8px 6px; border:1px solid #e6e6e6; vertical-align:top; }
    .two-cols { display:flex; gap:12px; }
    .left { flex:1 }
    .right { width:180px; text-align:center }
    .qr { width:140px; height:140px; margin:0 auto; }
    .footer { margin-top:18px; font-size:11px; color:#666; text-align:center }
    .reference { font-size:14px; font-weight:700; color:#000 }
    .price { font-size:16px; font-weight:700; color:#1f5233 }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">G</div>
    <div>
      <div class="company">GareCI</div>
      <div class="meta">Billet officiel de transport</div>
    </div>
  </div>

  <div class="section">
    <h3>Reservation</h3>
    <table class="grid">
      <tr>
        <td>Reference</td>
        <td class="reference">{{ reservation.reference|default:reservation.id }}</td>
      </tr>
      <tr>
        <td>Passager</td>
        <td>{{ user.first_name }} {{ user.last_name }}</td>
      </tr>
      <tr>
        <td>Trajet</td>
        <td>{{ trip.ville_depart.nom }} -> {{ trip.ville_arrivee.nom }}</td>
      </tr>
      <tr>
        <td>Date & heure</td>
        <td>{{ departure.date_depart|date:"d/m/Y H:i" }}</td>
      </tr>
      <tr>
        <td>Siege</td>
        <td>{{ reservation.seat_number|default:'N/A' }}</td>
      </tr>
      <tr>
        <td>Categorie</td>
        <td>{% if bus and bus.categorie %}{{ bus.categorie.nom }}{% else %}N/A{% endif %}</td>
      </tr>
      <tr>
        <td>Prix</td>
        <td class="price">{{ reservation.prix_total }} FCFA</td>
      </tr>
    </table>
  </div>

  <div class="section two-cols">
    <div class="left">
      <h3>Informations</h3>
      <p>Presentez ce billet (papier ou electronique) au personnel a l'embarquement.</p>
    </div>
    <div class="right">
      <div class="qr">
        <img src="data:image/png;base64,{{ qr_b64 }}" alt="QR code" style="width:100%; height:100%; object-fit:contain" />
      </div>
      <div style="margin-top:8px; font-size:12px">{{ qr_data }}</div>
    </div>
  </div>

  <div class="footer">Merci d'avoir choisi GareCI - Bon voyage !</div>
</body>
</html>
