{% extends 'dashboard/dashboard_base.html' %}
{% block title %}üìã R√©servations par date de voyage{% endblock %}
{% block content %}
<!-- ACCORD√âON PAR DATE DE VOYAGE -->
{% for item in dates %}
<div class="accordion-item" id="date-{{ item.date|date:'Y-m-d' }}">
  <div class="accordion-header" onclick="toggleAccordion('date-{{ item.date|date:'Y-m-d' }}')">
    <div class="accordion-left">
      <span class="accordion-icon">üìÖ</span>
      <span class="accordion-date">{{ item.date|date:"l d F Y" }}</span>
    </div>
    <div class="accordion-badges">
      {% if item.nb_confirmees %}
      <span class="badge badge-vert">‚úÖ {{ item.nb_confirmees }} confirm√©e(s)</span>
      {% endif %}
      {% if item.nb_en_attente %}
      <span class="badge badge-orange">‚è≥ {{ item.nb_en_attente }} en attente</span>
      {% endif %}
      <span class="badge badge-gris">üí∞ {{ item.recettes }} FCFA</span>
    </div>
    <span class="accordion-arrow" id="arrow-{{ item.date|date:'Y-m-d' }}">‚ñº</span>
  </div>
  <div class="accordion-body" id="body-{{ item.date|date:'Y-m-d' }}">
    <table class="table-reservations">
      <thead>
        <tr>
          <th>R√©f√©rence</th>
          <th>Client</th>
          <th>Trajet</th>
          <th>D√©part</th>
          <th>Places</th>
          <th>Total</th>
          <th>Statut</th>
          <th>Billet</th>
        </tr>
      </thead>
      <tbody>
        {% for resa in item.reservations %}
        <tr>
          <td><code>{{ resa.reference }}</code></td>
          <td>
            <strong>{{ resa.utilisateur.get_full_name|default:resa.utilisateur.username }}</strong><br>
            <small>{{ resa.utilisateur.phone }}</small>
          </td>
          <td>{{ resa.depart.trip.arret_depart.ville }} ‚Üí {{ resa.depart.trip.arret_arrivee.ville }}</td>
          <td>{{ resa.depart.heure_depart|time:"H:i" }} ‚Üí {{ resa.depart.heure_arrivee|time:"H:i" }}</td>
          <td>{{ resa.nombre_places }}</td>
          <td>{{ resa.prix_total }} FCFA</td>
          <td>
            {% if resa.statut == 'CONFIRMEE' %}
              <span class="badge badge-vert">‚úÖ Confirm√©e</span>
            {% elif resa.statut == 'EN_ATTENTE' %}
              <span class="badge badge-orange">‚è≥ En attente</span>
            {% endif %}
          </td>
          <td>
            {% if resa.statut == 'CONFIRMEE' %}
              <a href="{% url 'admin_voir_billet' resa.id %}" class="btn-sm btn-gris" target="_blank">üìÑ Voir</a>
            {% else %}‚Äî{% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% empty %}
<div class="empty-state">Aucune r√©servation pour le moment.</div>
{% endfor %}
<script>
function toggleAccordion(dateId) {
    const body  = document.getElementById('body-'  + dateId);
    const arrow = document.getElementById('arrow-' + dateId);
    const isOpen = body.style.display === 'block';
    body.style.display = isOpen ? 'none' : 'block';
    arrow.textContent  = isOpen ? '‚ñº' : '‚ñ≤';
}
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    const bodyDuJour  = document.getElementById('body-'  + today);
    const arrowDuJour = document.getElementById('arrow-' + today);
    if (bodyDuJour) {
        bodyDuJour.style.display  = 'block';
        arrowDuJour.textContent   = '‚ñ≤';
    }
});
</script>
{% endblock %}
